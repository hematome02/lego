const fetch = (...args) => import("node-fetch").then(({ default: fetch }) => fetch(...args));
  const fs = require('fs');

  /**
   * Parse webpage data response
   * @param  {String} data - html response
   * @return {Object} deal
   */
  const parse = data => {

    //Récupération des variables (titre, URL, price, favourite) sur Vinted
    const result = data.items.map((item) =>({
        //console.log(item.title);
        titre:item.title,
        //console.log(item.url);
        lienURL:item.url,
        //console.log(item.price.amount);
        price:item.price.amount,
        //console.log(item.favourite_count)
        favourite:item.favourite_count        
    }));

    return result; 
      
    };

  /**
 * Scrape a given url page
 * @param {String} url - url to parse
 * @returns 
 */

module.exports.scrape = async (url) => {
  const response = await fetch(url, {
    method: 'GET', // Optionnel, car GET est le comportement par défaut
    headers: {
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36',
      'Accept': 'application/json, text/plain, */*',
      'Accept-Language': 'fr',
      //'Set-Cookie': "_vinted_fr_session=aDFvYnRDc21VcFRwY0piZUg4L2MyNVFWL0t1aUFSSlF1SjZrakUveWRIUnJIdWNhUTZWV2RnLzNXNjMrQkROZ1pFRWtNZFl0YzlUZG9pWDlENFNEa0d6UXJJSE1laXJkemhiTkVFZ3hEVTlnYlVpdlRuU3BIU2FwRyttY3Z5eUwvRTZHNWQwdzZsaFF3UlBmM1grMXZVbVF5NzJna1NicFZ4VURkZWZMbU90YTRQWUErZE9WaSs4ZXN6ajlESDBOa2tWbWxlTzJoWDNwVU1yemJHQVZsVXdSSXlsMVZEWUVEWjUzLzdnNUFSdFk2Q1lxeWdFeUpGS1I2b1BUblJhdE50R3ZvU2Y2cXR0OFRjMi9EM3NCYk5VbWFNRWF3bEppRThWSm45aXYxTHhPd05INEdSR3RWU2I1TWxSRWVmeGJRRDJMWldKU1RUVm9hNXlUSEZReUhSdHhSWWI1Rks5a2VGOW5jb1hDTmdDME1SYkNYMmtTVU9pWDhUTm04eWQxV3NoRmF3bXI4Yjh0dzlDVGVIV29XSW1OQWlRR21XcnY0RzFWK3ZEWStpSUg5bkxGQUkxVmlaSm1vU2M1NnBURmNVRG9VOUlGa1A3U3ZSeElvR1ZzUXNUVUpHMEJEbHFCbnRDdXM1VGdjNklMd3BaV0ZpL1VTSVMwYXUwbEM0eUg1Sk41RmljYkZzazRuZHBrNUJHdFlFRDdBa0EvZndYdkYwWTZWcVY1ZUc5bGZZM1YzY08vRTQwVm1ER2pWVlU4cU91NDUrZGxIT1QxZmFEeTBESm9hSWRiaW1BVGdZMkgvdWM4U2s4UVFNL2lZVWVtMnNzdlE1SDBSL2YzdlovblBJWExleGhSZ0wrWnVHemNyeGtQaENkZUI2VFluYm1rSXh1dWwvRDN5ZVFFZ0NUVGtuUXpjUVZGRmwxM3hkNmxRRk1IUXFOYUZxazArUTV2Vzg1aXk4WW5uUE9Nb01STmNuUlZvK2tlODlQMVMzK0hzR1lNSkcvM0xQMlFEelkyNjRvcGRKbkpyajJPeHl2U2NLbzR6M2JxR0c2NjRJZ2ZvSXNacGtqZUVyTURiNDV2eVFKQ1BBRTRQbTVJQ3pXR2wvL1NqLzZvQmpjK2xvZXZFMkxmc1IzQ0lwR2NlWEZjSXVJM3YrclVZZlphaVU5QWNGclJ3b3RDeFJmdGdZZVVVWVpFSXFxREl2SFUzaG5pcDlGY2N0TVhhbGoxYlFySnVXYzJNZ3pxN29DMGdORXR6QVFQTTdOa1Z3eHp6SmZhOGU0azMrR3VyNUZVOGhBMk05bGYxamZHL2tmV2RDeUFRK0doMXdWZ3RiOVA1aSsxbnlMQ0RFdUEzMlVFV0FqQ0NxTjFiUVdPdC93M1ZaeUhjOVE3K1pqa3ovY1F6TUhvR1ZXMFl3aUs5YmRGbU16NzRyWmdKbVVCaDNYWlB2bEQrcFpxaExiZDkrbFZJMXpaRU1RcHl6d3Y1dG1WNGZHNjNXcThpdFFLMnZ5VW10ZWtaeHViMnJaT0JwUEkrRWRrUTJBSDd3TFBQSnZZdlNNY2x2N09UNmhwOW15Ymo4QmlrOUJmU0JBSVVHNHVLZlpORTkwMDNscHZEOWt5amJXbXpBUWd3WDR2ZGwxOFIrUHF0MFJNWTdRSDl6V2tjUEJRMEc1cWhMZnp2eStJdjNXSFhJWHllYUNzRWZiUTVxR2NXOWsweU9ZWCtjZkN5bkRkQ1M0c1V6SGlQN25UcW14UnZtQVVjc0MrMFc2NmhmZ1JGbUJSME83NlowNHFzWlBBOUROWk1xRFh1ZVpzKzRubXB5SnEyNEY1c2Y0ZWtGcjJsazlBdWs0VUNZVjk5Rkh6QVNlODVuMlFlYlpvMTVWWFNFOXNBMVR1QU1MbFhxWmd4SFVvZFJsVmswWjJPOTZJengvVjRJRWV6M0ZrbGI2OFJUaUVua0Y4eVVuZFlWK2o5ckFVRUpneUVOdWV0dDdXZjVleTRwS05GUmppQmFkbGV3aGlVSzFZb1E0WTV0d0o2eGRRTGpvWkd0MVdjTlM0M2ZuYkVKZGU2UmJrV29Tam85TDBpV1FOQnN5TFhTV0YxNUFYRmQ5c1VyTVVxT0k1Y0JuNnNiUGRYZFJLdDZhOEo2L1BoTVRyUU93bDZwb0NCODB4QXhIVm04d3kyMlZ5aXV6aGN4YVEvS1h1ams0VzljNVEwYTZ1RmpUTzcrb2VCMDJjS2ZjREpFUmYvY0xzb2NnMEh4ZnJNNkk1cXpZR0hENmFBaVFmR2VHY3B2Ky8zVmV5VXBzcjVqUENEQUk3LS1SU2Q5S1M0eTVxVnRnRnUzYTNsTFp3PT0%3D--30e42e18151e0e324aca7498cd03591bfafb4fac; domain=.www.vinted.fr; path=/; expires=Tue, 26 Nov 2024 13:41:28 GMT; secure; HttpOnly; SameSite=Lax",
      'Referer': "https://www.vinted.fr/catalog?brand_ids[]=89162&page=1&search_text=76434",
      'Connection': "keep-alive",
      "x-csrf-token":"75f6c9fa-dc8e-4e52-a000-e09dd4084b3e",
      "Cookie":"v_udt=aTV6VEhhMWR5Y211bFpVRGdIbWxET01FYk5sSS0tSWpyWjIwNlppcG5OMlRjeS0teHQrejlOaHRXS1VxTmEwcTBpd2JGdz09; anon_id=888aba30-e209-4d22-a2a3-2999ea83721e; ab.optOut=This-cookie-will-expire-in-2025; OptanonAlertBoxClosed=2024-11-18T15:40:35.472Z; eupubconsent-v2=CQISJZgQISJZgAcABBENBPFgAAAAAAAAAChQAAAAAAFBIIIACAAFwAUABUADgAHgAQQAyADUAHgARAAmABVADeAHoAPwAhIBDAESAI4ASwAmgBhwDKAMsAbIA74B7AHxAPsA_QCAAEUgIuAjABGgCggFQAKuAXMAxQBogDaAG4AOIAh0BIgCdgFDgKPAUiApsBbAC5AF3gLzAYaAyQBk4DLgGcwNYA1kBsYDbwG6gOCAcmA5cB44D2gIQgQvCAHQAHAAkAHOAQcAn4CPQEigJWATaAp8BYQC8gGIAMWgZCBkYDRgGpgNoAbcA3SB5IHlAPkAfuBAQCBkEEQQTAgwBCsCFw4BgAAiABwAHgAXABIAD8ANAA5wB3AEAgIOAhABEQCfgFQAL0AdIBHoCRQErAJiATKAm0BSACkwFdgLUAXQAxABiwDIQGTANGAaaA1MBrwDaAG2ANuAcfA50Dn4HkgeUA-IB9sD9gP3AgeBBECDAEGwIVjoJQAC4AKAAqABwAEAALoAZABqADwAIgATAAqwBcAF0AMQAbwA9AB-gEMARIAlgBNACjAGGAMoAaIA2QB3gD2gH2AfoA_4CKAIwAUEAq4BYgC5gF5AMUAbQA3ABxADqAIdAReAkQBMgCdgFDgKPgU0BTYCrAFigLYAXAAuQBdoC7wF5gL6AYaAx4BkgDJwGVQMsAy4BnIDVQGsANvAbqA4sByYDlwHjgPaAfWBAECFpAAmAAgANAA5wCxAI9ATaApMBeQDUwG2ANuAc_A8kDygHxAP2AgeBBgCDYEKyEB4ABYAFAAXABVAC4AGIAN4AegBHADvAH-ARQAlIBQQCrgFzAMUAbQA6kCmgKbAWKAtEBcAC5AGTgM5AaqA8cCFAELSUCEABAACwAKAAcAB4AEQAJgAVQAuABigEMARIAjgBRgDZAHeAPwAq4BigDqAIdAReAkQBR4CxQFsALzAZOAywBnIDWAG3gPaAgeSAHgAXAHcAQAAqACPQEigJWATaApMBiwDcgHlAP3AgiBBgpA3AAXABQAFQAOAAggBkAGgAPAAiABMACkAFUAMQAfoBDAESAKMAZQA0QBsgDvgH2AfoBFgCMAFBAKuAXMAvIBigDaAG4AQ6Ai8BIgCdgFDgKbAWKAtgBcAC5AF2gLzAX0Aw0BkgDJ4GWAZcAzmBrAGsgNvAbqA4IByYDxwHtAQhAhaUAQgAXABIAI4Ac4A7gCAAEiALEAa8A7YB_wEegJFATEAm0BSACnwFdgLoAXkAxYBkwDUwGvAPKAfFA_YD9wIGAQPAgmBBgCDYEKw.YAAAAAAAAAAA; OTAdditionalConsentString=1~; v_sid=3268dd8d-1731944430; anonymous-locale=fr; access_token_web=eyJraWQiOiJFNTdZZHJ1SHBsQWp1MmNObzFEb3JIM2oyN0J1NS1zX09QNVB3UGlobjVNIiwiYWxnIjoiUFMyNTYifQ.eyJhcHBfaWQiOjQsImNsaWVudF9pZCI6IndlYiIsImF1ZCI6ImZyLmNvcmUuYXBpIiwiaWF0IjoxNzMyMDQ5MDY1LCJzaWQiOiIzMjY4ZGQ4ZC0xNzMxOTQ0NDMwIiwic2NvcGUiOiJwdWJsaWMiLCJleHAiOjE3MzIwNTYyNjUsInB1cnBvc2UiOiJhY2Nlc3MifQ.P5o1wUB_HFMQR3X3v3LVix4_Cy4jX-j6eI06fnNTjY2flGP9S4ROruScqRFa88dubG5XYFY_JdExqEPRiWoPKiLGYDXuQk-5lTtAHNCgmBdo4Se4NhPP4g-KY0nVEhiBh4VKTp5evSo0IJ2nqBfBXGBszH0qQ9zj48TPOlB9uBf8VIeTyMBgN839W-LWdd8qxvQ3gzzNhEUXsjZCY9zJrfMTyaPQUvo2dLt1CBO7zkD49FNTcMmxe-C7u8c_8Kuo-VU9faGA-9kGUeFO5x7x9SEfG18L1IM9OO2eKnIZ4eZb8eOp32fNIkn9I-OqKuOkvSFUa0gDfFNeGHK28QilLA; refresh_token_web=eyJraWQiOiJFNTdZZHJ1SHBsQWp1MmNObzFEb3JIM2oyN0J1NS1zX09QNVB3UGlobjVNIiwiYWxnIjoiUFMyNTYifQ.eyJhcHBfaWQiOjQsImNsaWVudF9pZCI6IndlYiIsImF1ZCI6ImZyLmNvcmUuYXBpIiwiaWF0IjoxNzMyMDQ5MDY1LCJzaWQiOiIzMjY4ZGQ4ZC0xNzMxOTQ0NDMwIiwic2NvcGUiOiJwdWJsaWMiLCJleHAiOjE3MzI2NTM4NjUsInB1cnBvc2UiOiJyZWZyZXNoIn0.ifkECr-Iyr9zEILS56K_Nwp36CRNHw8e9vaPxPxGx9UcLCI8aX3X489ib61DDZq-ZTTEumAkoy9M4AnTl7N1gutkNCFGqVKimWgL9rxObg_pn1pdSSz5qDd-VolX4_IlJzmv0259oP0kCgU98SgwrY5aFvNNwVHsvnOki5uBKnZGKerPMqDHSAy1-jOS6HZ4542uo60JmbVeLtU6iqZuCt9Yq7vKG6oM9YPIZ8prF-pIkEydoUb-t1C9X77IJSG84qF9IPqZuhLya8JoICUkLGpNAIxZ456jIbcJKgquc0IBcQ7PZpu9CUb7DU3TYaliW0A25JKjfOiVEvZkmvuMFQ; __cf_bm=mq._GgF5QzyAGAiGosduJDBuwBNch8ALAztomyHO_jQ-1732049066-1.0.1.1-8GcVUS6XLDycru00RyFRaRbQIqujkJCjsEMXjNiKyGgcCqjgEWNsmtIjz2pqdt3TkzWMYZY1skO1rnQM0SYOyXHLMMcJvBrEhoBhsdr4r_w; cf_clearance=86WXV5f4tykbUFuXB7Ks7K6GZO8ODzy2wavadGDEYSc-1732049068-1.2.1.1-..gNXObC_8KkNCgBVhYFTYAhL4PJBz4aNyal1dg476fhZlX7iu1jAEvX5edatTbAPcC2T2vAS7fX1iTKdVdtWUK9bZYXyQqoUFWk9.l83HVoUpvP7aLTOqEZxDSeNKGc6FaOGASQmv_QTN6coiVpGfUbbffiaWIib9V380UfE_gW5j2c5iqhYajAJPy2OKetBZVhDHXj_YfSw2mafGQiY3MP3On55CBt1hKR6YR_BOTSzv7gkBRwPgypO.C4qBgsoMlX_l4MUI5sx7XgwIq.FcSoupRRjdaimwXo.nkFjjbHlEk4k7EFSUCuVwjTDCSzd4jzY4SCOWBApge8SHvKODkOpt1zxL5b_MvjlgEMz.B.H8iDWXepd61L2SiS1CEuiBrNJF9bDDDEHWYI6S_iRw; viewport_size=1121; datadome=MLu513106oIC3HPseK3X5L~P3Vb4chRJ8F1J2PPLAjUxGDsl3jGZ9_06pg6fYa~_kphdObP2TmXFQcm9Ikv9xe5MXZxzkrd7Uq4A5nid655FU6JmtpB5RnX00uv7H5ho; OptanonConsent=isGpcEnabled=0&datestamp=Tue+Nov+19+2024+21%3A46%3A03+GMT%2B0100+(heure+normale+d%E2%80%99Europe+centrale)&version=202312.1.0&browserGpcFlag=0&isIABGlobal=false&consentId=888aba30-e209-4d22-a2a3-2999ea83721e&interactionCount=14&hosts=&landingPath=NotLandingPage&groups=C0001%3A1%2CC0002%3A0%2CC0003%3A0%2CC0004%3A0%2CC0005%3A0%2CV2STACK42%3A0%2CC0015%3A0&genVendors=V2%3A0%2CV1%3A0%2C&geolocation=FR%3B&AwaitingReconsent=false; _vinted_fr_session=MDBmWkdQS3k5WU1heFFYUXRKenQrNENKN2VtemIzOHhjZlljZnVJTzdUWVJwWVJNSndYaXB5UUo1VGgzazFNZ0k4SGlhUW9WeDVKcDFVNUsycDQrcTAvRC92dFpJWWxnTFZwb0tuQUlqa2FsbTJncnNzWngrMlZKb3hJS3dZeGl4N2Y3WW8yZ3ZaRnljUVNLZ1Z0NnAwNmRLSjhwS00xVklFYm1MbEtHTU42eWd3Uld2bGRQbjdWUFJXQWVpN2dDVjAvckFpQjFVTnMwbjQzRHBPK25aYmpvVVpDVkNVaVlwdzJ2K2tTVnloWXpiZ1FwUkJNcXhvbllGVEx3UjVqemdsV3YrTEVLaklLbVJYb1pUVVVpOXpMOE1SS0tKMGVCVTZhQTlGU3BWN1hsSW1BdjBlcXVGdUtuY2NSVUFHTXdxcC92bkVnYU01N3FxcmdKMWVzN0Z5cUNLa1F5aFVmdmJVUkNBNTBteExqVHo4cmRzQklkWUY3aExKL1ZFOEt2Rm03YWd0enhncXRGZGo5RWMvOWlTQ0hseGRoelFJdkNITTV3L3hUOHNMam1aZ09sT1B2Qk9Va21raDNDaThhWU1GU3V0OUdNY1VqSlFHMHE0b2pDZ2JidlkzZUtSNVVvRXRTUkNEYjhZYmxDWkdXVVp2b3h4UXVmVGdUSFVNVmVwR0ZHOHIzWHZsWW1tYmxONzZ6ekVUY0tzM2kwdjVXQUduL04wMFVFcnQrNkdhWlNUblZhUkxyWTBLdVpaK21Uei9XUVZIeWNTbDIzSXZtREpyTSttMkR3NERyNlpESVhYRktYakFPOGl1RFF0T0NpSTZnZEpwZ0FYOGJHSU9oVVFFU0xFVG93cXZ5UnkwYlNoZitkTXZHNVJzZUVXSUdJdzZtbm9DYTlCMHJHdG9RaWtjbExyWjZaUTM4d1hJNlM1OHZsMkRBejBJRU11SjIxOEpUSEwxNmthVW5PNVNHV0t4WGxqTGZBU1J5TVdYcFlMTERteGF1bnkyelB6WmozZllhbmIxSTZZUHRlSlNpNGZhRHNDemdzVkZhSWFaRTRVdnRjMEVpTVlVV0dvbTNtK2ZTTmU4dzlUVk1wb1hFSkI3YVY0Y2dHc2cxR01lMjM2U0VsQm5rc09IVFpvblFSbnVOV21Wa1Z2c0J0eHFMZmkwaklSQTNYMG5IMXpWczZkWENjdERoUXlESkVSa0g4emh3YU03N3BWN01EUE5LSXdNZEZaRjhNTXZWZUEvWHo4UnJhOFpQUzFCRGpMYis4dlJGbUZhMVo2Z0hmbDhKMHBpYlB2QlFHaHRxVXVRYVZkRXFERTRlL04wYlBpNjdYUkVsTkhqNW1wOHVUSnlwa3VXS0wzckhuQSsxQTAyaVNCSDVpbk9PYmhMRVBoN3FZZ0pRV0pPQUE4aEdXNWdNYTRwaTJCbTczenF0bVhPS0tSNTc1VXcrbS9EMkZuWHBtczUwVTg3c3FyOXU5c0JIY0JWeEZvdDNMcXhtZW9hQkIrcExidUs4ODV2dkt6anRmdElYS0pnV3YzbEt4UG41c0QzU0ROa0I4MkFoQSs2aTJNaDI5R2U5WnArL0JqVUlJV1dLMnlCQ3UxdjNFcDlkdytiTDhwemUvaFF2bWVIaGcwSGV5Yk9RYWtrMTdjcTJIdGFVaWVMb1FjeEVrMVV1ZTRldElXOFFPTlAxaGdzWG5LTmJqZzRIaUlXSzVzMkNtUU42K3JFd283QnIrd25Pck1jeUlOUEJTRzQ4R0p6RFRySmF4NlRqZ3Y2d21NY2RFS2NhbnlybVViSFI1VHJ1K2ppNDRudTJ0NWJNNFNmcGJCWi95bENCMi9tTmZXUnEvOE1HcWU0dVRYRUVGckxpUkczUCtRQlRBYkhvVG5nMXVhMnJYSGVXeGFSNXZ2UzdQYnFDaUdzcXNkZFd1M0oxcmMrNGxtZlhJbHJiSldEL2RIRHdwVnprdWlnZ2RDZ0hZSDdiQ0ltU21MbER5L2w3NlF0a2pMTm9BZzJIYXU3OEI5TjRMZDRjdVlLdlJsVUNXd1VqajFCbFEydWVualFnY2VOaFdxRzl3dnBNcmtMMnNGM2NQMyt1RXlDWW5ocURaMGNNRS9BUEIxaHF0b0hUQTV1ei9CcWVsR2Vrc0Z1Q2RYQ3BrcFhhZnlmV2laa3dDWDJ2bkkyQm4zNzZOd2FZbjRNYUVaWHFBM1ZLTlF1QkQ4YllaYmxiSm1ORndzeEJRbEgxa3FmYk5UL0FRc2cwT2JwYXRONFBaeG5TTk1zVk1obGlaQldBY3ljYUpoU2ZELS1qNzEycTZHNGhRby94emNYaXJXNEh3PT0%3D--7579ac591257a09af82b392ca88e015a43ce972a; _dd_s=rum=0&expire=1732050062342; banners_ui_state=PENDING",
      // Ajoutez d'autres headers ici si nécessaire
    },
  });

  if (response.ok) {
    const body = await response.json();
    //console.log("body" , body);    
    console.log(`Vinted Data accessed`);
    const parsedData = await parse(body);
    //console.log(parsedData);

    return parsedData;
  }
  console.error(`Request failed with status ${response.status}-${response.statusText}`);
  return null;
};
