const fetch = (...args) => import("node-fetch").then(({ default: fetch }) => fetch(...args));
  const fs = require('fs');

  /**
   * Parse webpage data response
   * @param  {String} data - html response
   * @return {Object} deal
   */
  const parse = data => {

    //Instanciation des variables à récupérer sur Vinted 
    let titre="";
    let lienURL="";
    let price =-1;
    let favourite=-1;

    //Récupération des informartions sur Vinted
    const result=data.items.map(item =>{
        console.log(item.title);
        titre=item.title; 
        console.log(item.url);
        lienURL=item.url
        console.log(item.price.amount);
        price=item.price.amount;
        console.log(item.favourite_count)
        favourite=item.favourite_count;
    });

    return result; 
      
    };

  /**
 * Scrape a given url page
 * @param {String} url - url to parse
 * @returns 
 */

module.exports.scrape = async (url) => {
  const response = await fetch(url, {
    method: 'GET', // Optionnel, car GET est le comportement par défaut
    headers: {
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36',
      'Accept': 'application/json, text/plain, */*',
      'Accept-Language': 'fr',
      //'Set-Cookie': "_vinted_fr_session=aDFvYnRDc21VcFRwY0piZUg4L2MyNVFWL0t1aUFSSlF1SjZrakUveWRIUnJIdWNhUTZWV2RnLzNXNjMrQkROZ1pFRWtNZFl0YzlUZG9pWDlENFNEa0d6UXJJSE1laXJkemhiTkVFZ3hEVTlnYlVpdlRuU3BIU2FwRyttY3Z5eUwvRTZHNWQwdzZsaFF3UlBmM1grMXZVbVF5NzJna1NicFZ4VURkZWZMbU90YTRQWUErZE9WaSs4ZXN6ajlESDBOa2tWbWxlTzJoWDNwVU1yemJHQVZsVXdSSXlsMVZEWUVEWjUzLzdnNUFSdFk2Q1lxeWdFeUpGS1I2b1BUblJhdE50R3ZvU2Y2cXR0OFRjMi9EM3NCYk5VbWFNRWF3bEppRThWSm45aXYxTHhPd05INEdSR3RWU2I1TWxSRWVmeGJRRDJMWldKU1RUVm9hNXlUSEZReUhSdHhSWWI1Rks5a2VGOW5jb1hDTmdDME1SYkNYMmtTVU9pWDhUTm04eWQxV3NoRmF3bXI4Yjh0dzlDVGVIV29XSW1OQWlRR21XcnY0RzFWK3ZEWStpSUg5bkxGQUkxVmlaSm1vU2M1NnBURmNVRG9VOUlGa1A3U3ZSeElvR1ZzUXNUVUpHMEJEbHFCbnRDdXM1VGdjNklMd3BaV0ZpL1VTSVMwYXUwbEM0eUg1Sk41RmljYkZzazRuZHBrNUJHdFlFRDdBa0EvZndYdkYwWTZWcVY1ZUc5bGZZM1YzY08vRTQwVm1ER2pWVlU4cU91NDUrZGxIT1QxZmFEeTBESm9hSWRiaW1BVGdZMkgvdWM4U2s4UVFNL2lZVWVtMnNzdlE1SDBSL2YzdlovblBJWExleGhSZ0wrWnVHemNyeGtQaENkZUI2VFluYm1rSXh1dWwvRDN5ZVFFZ0NUVGtuUXpjUVZGRmwxM3hkNmxRRk1IUXFOYUZxazArUTV2Vzg1aXk4WW5uUE9Nb01STmNuUlZvK2tlODlQMVMzK0hzR1lNSkcvM0xQMlFEelkyNjRvcGRKbkpyajJPeHl2U2NLbzR6M2JxR0c2NjRJZ2ZvSXNacGtqZUVyTURiNDV2eVFKQ1BBRTRQbTVJQ3pXR2wvL1NqLzZvQmpjK2xvZXZFMkxmc1IzQ0lwR2NlWEZjSXVJM3YrclVZZlphaVU5QWNGclJ3b3RDeFJmdGdZZVVVWVpFSXFxREl2SFUzaG5pcDlGY2N0TVhhbGoxYlFySnVXYzJNZ3pxN29DMGdORXR6QVFQTTdOa1Z3eHp6SmZhOGU0azMrR3VyNUZVOGhBMk05bGYxamZHL2tmV2RDeUFRK0doMXdWZ3RiOVA1aSsxbnlMQ0RFdUEzMlVFV0FqQ0NxTjFiUVdPdC93M1ZaeUhjOVE3K1pqa3ovY1F6TUhvR1ZXMFl3aUs5YmRGbU16NzRyWmdKbVVCaDNYWlB2bEQrcFpxaExiZDkrbFZJMXpaRU1RcHl6d3Y1dG1WNGZHNjNXcThpdFFLMnZ5VW10ZWtaeHViMnJaT0JwUEkrRWRrUTJBSDd3TFBQSnZZdlNNY2x2N09UNmhwOW15Ymo4QmlrOUJmU0JBSVVHNHVLZlpORTkwMDNscHZEOWt5amJXbXpBUWd3WDR2ZGwxOFIrUHF0MFJNWTdRSDl6V2tjUEJRMEc1cWhMZnp2eStJdjNXSFhJWHllYUNzRWZiUTVxR2NXOWsweU9ZWCtjZkN5bkRkQ1M0c1V6SGlQN25UcW14UnZtQVVjc0MrMFc2NmhmZ1JGbUJSME83NlowNHFzWlBBOUROWk1xRFh1ZVpzKzRubXB5SnEyNEY1c2Y0ZWtGcjJsazlBdWs0VUNZVjk5Rkh6QVNlODVuMlFlYlpvMTVWWFNFOXNBMVR1QU1MbFhxWmd4SFVvZFJsVmswWjJPOTZJengvVjRJRWV6M0ZrbGI2OFJUaUVua0Y4eVVuZFlWK2o5ckFVRUpneUVOdWV0dDdXZjVleTRwS05GUmppQmFkbGV3aGlVSzFZb1E0WTV0d0o2eGRRTGpvWkd0MVdjTlM0M2ZuYkVKZGU2UmJrV29Tam85TDBpV1FOQnN5TFhTV0YxNUFYRmQ5c1VyTVVxT0k1Y0JuNnNiUGRYZFJLdDZhOEo2L1BoTVRyUU93bDZwb0NCODB4QXhIVm04d3kyMlZ5aXV6aGN4YVEvS1h1ams0VzljNVEwYTZ1RmpUTzcrb2VCMDJjS2ZjREpFUmYvY0xzb2NnMEh4ZnJNNkk1cXpZR0hENmFBaVFmR2VHY3B2Ky8zVmV5VXBzcjVqUENEQUk3LS1SU2Q5S1M0eTVxVnRnRnUzYTNsTFp3PT0%3D--30e42e18151e0e324aca7498cd03591bfafb4fac; domain=.www.vinted.fr; path=/; expires=Tue, 26 Nov 2024 13:41:28 GMT; secure; HttpOnly; SameSite=Lax",
      'Referer': "https://www.vinted.fr/catalog?brand_ids[]=89162&page=1&search_text=76434",
      'Connection': "keep-alive",
      "x-csrf-token":"75f6c9fa-dc8e-4e52-a000-e09dd4084b3e",
      "Cookie":"v_udt=aTV6VEhhMWR5Y211bFpVRGdIbWxET01FYk5sSS0tSWpyWjIwNlppcG5OMlRjeS0teHQrejlOaHRXS1VxTmEwcTBpd2JGdz09; anon_id=888aba30-e209-4d22-a2a3-2999ea83721e; ab.optOut=This-cookie-will-expire-in-2025; OptanonAlertBoxClosed=2024-11-18T15:40:35.472Z; eupubconsent-v2=CQISJZgQISJZgAcABBENBPFgAAAAAAAAAChQAAAAAAFBIIIACAAFwAUABUADgAHgAQQAyADUAHgARAAmABVADeAHoAPwAhIBDAESAI4ASwAmgBhwDKAMsAbIA74B7AHxAPsA_QCAAEUgIuAjABGgCggFQAKuAXMAxQBogDaAG4AOIAh0BIgCdgFDgKPAUiApsBbAC5AF3gLzAYaAyQBk4DLgGcwNYA1kBsYDbwG6gOCAcmA5cB44D2gIQgQvCAHQAHAAkAHOAQcAn4CPQEigJWATaAp8BYQC8gGIAMWgZCBkYDRgGpgNoAbcA3SB5IHlAPkAfuBAQCBkEEQQTAgwBCsCFw4BgAAiABwAHgAXABIAD8ANAA5wB3AEAgIOAhABEQCfgFQAL0AdIBHoCRQErAJiATKAm0BSACkwFdgLUAXQAxABiwDIQGTANGAaaA1MBrwDaAG2ANuAcfA50Dn4HkgeUA-IB9sD9gP3AgeBBECDAEGwIVjoJQAC4AKAAqABwAEAALoAZABqADwAIgATAAqwBcAF0AMQAbwA9AB-gEMARIAlgBNACjAGGAMoAaIA2QB3gD2gH2AfoA_4CKAIwAUEAq4BYgC5gF5AMUAbQA3ABxADqAIdAReAkQBMgCdgFDgKPgU0BTYCrAFigLYAXAAuQBdoC7wF5gL6AYaAx4BkgDJwGVQMsAy4BnIDVQGsANvAbqA4sByYDlwHjgPaAfWBAECFpAAmAAgANAA5wCxAI9ATaApMBeQDUwG2ANuAc_A8kDygHxAP2AgeBBgCDYEKyEB4ABYAFAAXABVAC4AGIAN4AegBHADvAH-ARQAlIBQQCrgFzAMUAbQA6kCmgKbAWKAtEBcAC5AGTgM5AaqA8cCFAELSUCEABAACwAKAAcAB4AEQAJgAVQAuABigEMARIAjgBRgDZAHeAPwAq4BigDqAIdAReAkQBR4CxQFsALzAZOAywBnIDWAG3gPaAgeSAHgAXAHcAQAAqACPQEigJWATaApMBiwDcgHlAP3AgiBBgpA3AAXABQAFQAOAAggBkAGgAPAAiABMACkAFUAMQAfoBDAESAKMAZQA0QBsgDvgH2AfoBFgCMAFBAKuAXMAvIBigDaAG4AQ6Ai8BIgCdgFDgKbAWKAtgBcAC5AF2gLzAX0Aw0BkgDJ4GWAZcAzmBrAGsgNvAbqA4IByYDxwHtAQhAhaUAQgAXABIAI4Ac4A7gCAAEiALEAa8A7YB_wEegJFATEAm0BSACnwFdgLoAXkAxYBkwDUwGvAPKAfFA_YD9wIGAQPAgmBBgCDYEKw.YAAAAAAAAAAA; OTAdditionalConsentString=1~; __cf_bm=U8akLrn.HVuBsrNNfFXmftFE7E6PerwhlnkoZCWC1cY-1732023589-1.0.1.1-Q9kL1CwBN2tD2jU4KuftYptdlUP23HhWQ60uYfT3tXGc3WlNGjlEuDjjNVMgLYJd_gUb4uKwJXez.FWK8c_UcHQaKX1_OJJxhfT7MBkMs_0; access_token_web=eyJraWQiOiJFNTdZZHJ1SHBsQWp1MmNObzFEb3JIM2oyN0J1NS1zX09QNVB3UGlobjVNIiwiYWxnIjoiUFMyNTYifQ.eyJhcHBfaWQiOjQsImNsaWVudF9pZCI6IndlYiIsImF1ZCI6ImZyLmNvcmUuYXBpIiwiaWF0IjoxNzMyMDIzNTg5LCJzaWQiOiIzMjY4ZGQ4ZC0xNzMxOTQ0NDMwIiwic2NvcGUiOiJwdWJsaWMiLCJleHAiOjE3MzIwMzA3ODksInB1cnBvc2UiOiJhY2Nlc3MifQ.rtEo3ErN8y0IkSGTEGr63ywftnb4C0DZOw-1ci-PQFttc7aS5IVNn6kJBG3UrNYgVe-Qjc77sMl1VE3JDEEWwPBjOUz-zOtZFragJbAvu94RdhbPQSLzN5JnI_rkQxRy4Rv7GkubjQih9vDns3ijofrf4OFB5FQPh2N1ipVtyk6iP1nxi6B-VABiq1PDs-ocR_w8g5iL7QREkp80Z6dZ4vl3hHL3c1lZrdsK2IarSkzivdwfKrECzeCz2fy9UCZnEWuF5INHx3nuPZTXeeL1aoxyvqqWi6Q1rk73sKnk8ljyLRcBdwDCVj1coH_fIGprD2jpbos_gL5rwKIk71jZ5Q; refresh_token_web=eyJraWQiOiJFNTdZZHJ1SHBsQWp1MmNObzFEb3JIM2oyN0J1NS1zX09QNVB3UGlobjVNIiwiYWxnIjoiUFMyNTYifQ.eyJhcHBfaWQiOjQsImNsaWVudF9pZCI6IndlYiIsImF1ZCI6ImZyLmNvcmUuYXBpIiwiaWF0IjoxNzMyMDIzNTg5LCJzaWQiOiIzMjY4ZGQ4ZC0xNzMxOTQ0NDMwIiwic2NvcGUiOiJwdWJsaWMiLCJleHAiOjE3MzI2MjgzODksInB1cnBvc2UiOiJyZWZyZXNoIn0.yr4_X5PuBNH4hjF-PYebk96-K_Ho1SfaEh9VpkN1kAL7_iz_ZZAGO276tlvXa1pSRbOq363X27IfWg_7lOZDFWRybpkFtntDD-nDI8zOFpyMS_8JEB6Ff-xOOIMCSOWQGP5jOFLCjRslBtugkM2SqsqEH0AdHVfoS5NP4wvIaOi9Wza1QjCEZcsUo-uhtb0F5QV4t9uN0nl-xRaHUBSfOyMBEFRImpT8dxhxchR5pj_mMHDKZcfq6BOam7IKjFo9IJclmOU-8rerFR93z_ni-L1gOx2fIPF_6CvNkEdCNes8F7zzX2KO_6ig-zrToFm5y4pA_HUU7U4KY3LJyCSTSg; v_sid=3268dd8d-1731944430; anonymous-locale=fr; cf_clearance=XmqkbuadyTg.WI0AB6tov7pk8ytBx4A367mJ3xQ0RGQ-1732023599-1.2.1.1-ipKGBAmDHukYcsFYgWqjPLHzmTZ_0U6O9GB_y8lcjW_QzOPCPqf37sAgGAq_aODYCGLJWul_nbZNXyxyP5tyRqqjkG74rYy58nJEzk4vp0j4vPQVFPd1pyLSzptgY3Oni1NU3BRz5QEOYuJABnWyU3CAvshETkPcXYLnW8F78nOTJ2cAXLdY3OoP0cCUwHOcOGlCGMxFqSsDKOj1n_AmJ33i4Jm_okC3nOVdoygOoqp7I_57n.JWG7mzMhRrdmXD1GeYIA.s_B2.67koZrNCqTs.Yim_k8JguWMVRt.jyFlmf9QoLmPeunKciTNZQZ.sjVGQbksIoGnIlafuMR8Tl7sZaTNyblyFyACyzEYzCUnwGf6WQ5pWEkiIi1HnrFjy; datadome=R0EuXgf35Q9MmSCn6Tx7Y_vK3y8kNl~L8xRqaVf5xjgrw0pbOvAvgPj2Rb_d3PXCHAPCHlUsi6haVIbyp054HAk35HltPyZHSmHKPKjtXgkassnYC4yhtR1WxLi~o_Wk; viewport_size=738; OptanonConsent=isGpcEnabled=0&datestamp=Tue+Nov+19+2024+14%3A41%3A22+GMT%2B0100+(heure+normale+d%E2%80%99Europe+centrale)&version=202312.1.0&browserGpcFlag=0&isIABGlobal=false&consentId=888aba30-e209-4d22-a2a3-2999ea83721e&interactionCount=7&hosts=&landingPath=NotLandingPage&groups=C0001%3A1%2CC0002%3A0%2CC0003%3A0%2CC0004%3A0%2CC0005%3A0%2CV2STACK42%3A0%2CC0015%3A0%2Cgad%3A0%2CM0001%3A0&genVendors=V2%3A0%2CV1%3A0%2C&geolocation=FR%3B&AwaitingReconsent=false; _vinted_fr_session=YUZpeDBMQUNvRERZU1QwNlB3enpKSUdJZXc2cWZwSFNiWEQ0ZjFRM3g5WUtaZU5obkNtUWtMVjZqOU9nZzRWcG9VWlFqSXVtZHNHRUdmYVJtZlljeHVObHlTdVZwSXZGUm10dHkvcGNPQUxnS1EzRi9NZG1ZL2lnc2hLbDBKMkxUVGxzOEs3UnRnMXNjZ0dzUEwrcjNaV1oxZ282NlZBNVJPMUpiL1F1RkhQY2YrUENqY0Z4MWUxWEpvNGc2THU2SVhSQ3NQK3loeTBKUzViNjV4SGp0ZUVaSGIxUDZOcjhVVXZhT3VpS2lFT2pMUXc3cWxLQWg2UzQ2SWlHWW1HQTVKaDR2eUo0Sm5qbmgvcVIxZFM2RzJKMjdaRnMyWEUrcVRjc3dIejdlNTVhTzZHYmE3c21IMzJxQ0ViZ1pHMEtEbEdEa3FERTVxSldMMUxmZXdCREppeVFTSVRYU0ZCazF3UmR2azUyOENEckdrMDRzTTgzNUlrcDYrTmFidWVQRG9Yd3BjWlV2V2drZklGSUgzV3krbWJqUUM5alBuRm1RdUJLS3o4bmk3NkJsV3dmQ0NvbGpWRFRkWlduWk9CVSsrNmVQbkZTL1NrS2hKUkpuanowSlNkcE1ZTkZIb0FzcjZNOVhpZEJVOTdFSHo3OG5vQ2ZhMjhRb20yVHdGL0srVkd6R1VzSUVSTG95VFYvOENFTHJxcVBmM1cydEZURENNRjE1cy9XNmtHbFZhSjdlVEhKU0lnWllVbnJhK1NXUm1YZEt1c3VpSWtKbmVxZEkyUGh6TTNkQk14c1NDOUZnNUZRaGF4eTNJRWM3aGpLSGVJTS9kTjNjUUM2OWgwdFlyZjdYSmdiVVBDamd4NlFqT0RXUjUySy8ybDF5UzFFWUJhbHVFSVpJNnE3MVB0VHBrM0V2cm1GNFdyNExNL3BvRW4zdmJya1pNR2ZzSW1GUTREUkZtMzVDVnBuQksyUHBMQzdLYW5na09TT3JIaWZaRWkzMm9MN1d3YUJsUTFKczJTSXhtR2VDS0JtYUcxRDl1c0hlNjMzcld0NSs4Rm9YSDZFVUZmcjJmb2xVYXFndklmY2hlclVRQjBDc3l5WmlQSW10emd5djNVWjF2RTdRZWw0aG93eVY4N092UEVWV3hUeWpZN2ZFOHZDY1lXQjZxQUlNS2JNUy9VcjBHZmxiMGFZNytMdEV4SS8yby8xbjI4WmZtVW1zVjd1YVBxSjVqcFN0N2t6YXFMUDEzaTNqRFpKOGdXb3paaGJybUFrU2sraWFMc09zeFJoNlkyR3pnY0FLc0ViR1BXVzJLUUFNekVyL25PeUVyUVVHRWI2UnFtMVR1ZlZlOG54di9YaGFKT051dS9Cc0VJVHpaRUxHYTRIdDBFS2VyWDRudVcrRE9ybDUrbWJ1a2dGdVpSODFxNGJFNTMwdU4yRHBDS25PeU9lSWhFNGlnSklTbk1heUl4SWVBTENqUTdIMFFVZWR6NDh5NWVsYk5VRStncDBIV2FqWXRVaW15b05JaVEzb2FxbDZ0Z0ticUg0Z2x1cVM0OTN0N3kxODhUK2NvYWozeWRGWm9nNmMwVi80NDA1eEJpRTM1Vk1LRDVjRlowV1hYUFNKVTNKVENEOWQzNkZCdDJxZjFVN1duQWl2Kys2R2lBcE5kR2paSGlQSGN6U01sdmFUL3R0cTNEL2J1MUZGUHBLWVRQS1hYTTExWVJ1VVA4V1R0RmFPYktUMUpSdUNGRUZJQXBRWllwbWw0U1g3S0xIYlM0cDIraFZqKzBibW9OZ1Q2M1kwTnBjZk8vMkhqdUcxenBEU3FzUFhCSUx1VlJ6YWY3clRDZlY5YkI1Q3laUTFYV3RsaEptbXRLajhaQ1NvZDgvdVh1RmFKa2F4cEFzelZhTVNPd1ZkcWNGbEt2Q2ZIMXJZYStpVjA5bnlqdHd2VnYrQ1ZPNEQxdVVTajRTY0Vqa0NQWmZ4cisvNmRVOFhOaEgxTXU1NEllZENyc0ZpV0pHYXZ2QitQbWppbzMzRFBCdmVXK09obzFUV2gxMDhVd0pDSTU0eExaSERIdkdtbktKYmtpUE8zRWpJeGZlVDkyOCtIM2ZpMmpQRGNMY1VaWWlXWVhqWmhxVWVVLzJXQjI0SkNobUY4N0VxMHcyQ1BpYUtuKzN4UGtmd25LNzlWTkhzZStYaUVubEY2L3ppa1VycHBLQUxqQmNheWFMVTN3MFlxcUtIYjVjUXlDd1V5TEVpRDVxWkFBWnR4ZmFLc2hqSDRteXJ5elNPT1pvTjlGeWtlNm1OYS9iLS01RXlRbGZNTC9ERWUyYlc0R2gxWFJnPT0%3D--e8b80e3a39811f746b02cfe0c8c8d9cc8f5de056; _dd_s=rum=1&id=e305a992-014b-45e2-b16a-5e11c45cd258&created=1732023598935&expire=1732024582067; banners_ui_state=PENDING",
      
      // Ajoutez d'autres headers ici si nécessaire
    },
  });

  if (response.ok) {
    const body = await response.json();
    //console.log("body" , body);    
    console.log(`Vinted Data accessed`);
    const parsedData = parse(body);    
    return parsedData;
  }

  console.error(`Request failed with status ${response.status}-${response.statusText}`);
  return null;
};
